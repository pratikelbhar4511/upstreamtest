<!DOCTYPE html>
<html>
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="dist/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
<link rel="stylesheet" href="dist/css/AdminLTE.min.css">
<link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="dist/css/blink.css">

<style type="text/css">
    html,
    body {
        /* width: 100%;
        height: 100%; */
        margin: 0;
        padding: 0;
        font-size: 12px;
    }

    /* .table td {
        font-size: 150%;
    } */

    .table,
    th,
    td {
        border: 1px solid black;
    }

    /* .blink_me {
  animation: blinker 1s linear infinite;
} */
    .blink {
        animation: blinker 1s linear infinite;

    }

    @keyframes blinker {
        100% {
            opacity: 1.0;

        }
    }

    #Progressdiv {
        width: 0.21%;
        height: 100%;
        float: left;
    }

    .linestatus {
        width: 98%;
        /*height: 5%; */
        margin-left: 1%;
        margin-bottom: 1%;
        background-color: lightgray;
    }

    .linename {
        text-align: center;
        font-weight: bold;
    }

    .bar {
        height: 20px;
        border-radius: 5px;
        overflow: hidden;
    }

    .lightgray {
        background-color: lightgray;
    }

    .green {
        background-color: green;
    }

    .red {
        background-color: red;
    }

    .lanbtn {
        background-color: #3c8dbc;
        color: white;
        text-align: center;
    }

    .lanbtnrem {
        background-color: gray;
        color: white;
        text-align: center;
    }
</style>
<meta http-equiv="Refresh" content="300">

<body>

    <section class="content-header">
        <div class="row">
            <div class="col-xs-1" style="margin-left: 1%;">
                <span class="logo-lg"> <img src="dist/img/MintFDI.png" height="40" style="width: 100%;min-width: 50%;">
            </div>
            <div class="col-xs-2">
                <a href="/Dashboard.html">
                    <div style="background-color:#3c8dbc;text-align: center;cursor: pointer;">
                        <!-- <div class="btn btn-primary"> -->
                        <span id="lblBatchAssi" style="color:White;font:bold;cursor:pointer;">LOSS
                            ASSISTANCE </span>
                        <br /><span style="color:White;cursor: pointer;">Click Here For More Details...</span>
                    </div>
                </a>
            </div>
            <div class="col-xs-6">
                <h4 style="font-weight:bold;font-family: Verdana, Geneva, Tahoma, sans-serif;text-align: center;">
                    Speed Loss Dashboard - Unit 1 Cascade 1
                </h4>
            </div>
            <div class="col-xs-1" style="float: right;">
                <div id="btnEng" onclick="ShowENG();" class="lanbtnrem" style="width: 80%;">English</div>
            </div>
            <div class="col-xs-1" style="float: right;">
                <div id="btnHin" onclick="ShowHIN();" class="lanbtn" style="width: 80%;margin-left: 50%;">Hindi</div>
            </div>

        </div>
        <div class="row" style="margin-top: 1px;">
            <div class="col-xs-3" style="text-align: center;height:150px;border: 1px solid #b2b3b4 !important;margin-left: 2%;font-size: 15px;">

                <div class="row" style="margin-top:10%;">
                    <div class="col-xs-4">
                        <b>Date</b>
                    </div>

                    <div class="col-xs-6">
                        <label id="lblDate"></label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-4">
                        <b>Time</b>
                    </div>
                    <div class="col-xs-6">
                        <label id="lbltime"></label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-4">
                        <b>Shift</b>
                    </div>
                    <div class="col-xs-6">
                        <label id="lblShift"></label>
                    </div>
                </div>

            </div>
            <div class="col-xs-4" style="height:150px;border: 1px solid #b2b3b4 !important;margin-left: 2%;">
                <div class="row" style="text-align: center;">

                    <label id="lblLivePerformance" style="font-family: Verdana, Geneva, Tahoma, sans-serif;"><b>Upstream
                            Live Performance</b>
                    </label>

                </div>
                <div class="row">
                    <div class="col-xs-6 text-center">
                        <label id="lbloee"><b>OEE</b></label>
                    </div>
                    <div class="col-xs-6 text-center">
                        <label id="lblSpeed"><b>Speed</b></label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-6 text-center">
                        <div class="row">
                            <input type="text" id="casoee" class="knoboee" value="0" data-width="100" data-fgcolor="#00a65a"
                                data-readonly="true" />
                        </div>
                    </div>

                    <div class="col-xs-6 text-center">
                        <div class="row">
                            <input type="text" class="knobspeed" id="casspeed" value="0" data-width="100" data-fgcolor="#932ab6"
                                data-readonly="true" />
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-xs-4" style="height:150px;border: 1px solid #b2b3b4 !important;margin-left: 2%;">
                <div class="row" style="text-align: center;">
                    <label id="lblShiftRunningStatus" style="font-family: Verdana, Geneva, Tahoma, sans-serif;"><b>
                            Line Running Status</b>
                    </label>

                </div>
                <div class="row">
                    <div class="row">
                        <div class="col-xs-2 linename">Line 1</div>
                        <div class="col-xs-10">
                            <div id="btn1" class="linestatus bar"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2 linename">Line 2</div>
                        <div class="col-xs-10">
                            <div id="btn2" class="linestatus bar"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2 linename">Line 3</div>
                        <div class="col-xs-10">
                            <div id="btn3" class="linestatus bar"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2 linename">Line 4</div>
                        <div class="col-xs-10">
                            <div id="btn4" class="linestatus bar"></div>
                        </div>
                    </div>
                </div>
            </div>

    </section>

    <section class="content">
        <div class="row">
            <div class="col-xs-6">
                <div>
                    <div class="box box-solid">
                        <div class="box-header">
                            <h4 class="box-title" style="font-weight:bold;font-size:150%;">Current Shift Details</h4>
                        </div>
                        <div class="box">
                            <div class="nav-tabs-custom">
                                <div class="tab-content no-padding" style="margin-top: 2%;">
                                    <div id="oeeChart" class="chart tab-pane active" style="position: relative;">
                                        <canvas id="myChart" style="max-width: 98%; min-height: 90%;"></canvas>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="box box-solid">
                        <div class="box-header">
                            <h4 class="box-title" style="font-weight:bold;font-size:150%;">Previous Shift Details</h4>
                        </div>
                        <div class="box">
                            <div class="nav-tabs-custom">

                                <div class="tab-content no-padding" style="margin-top: 2%;">
                                    <div id="Chart" class="chart tab-pane active" style="position: relative;">
                                        <canvas id="barChart" style="max-width: 98%;min-height: 100%;"></canvas>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-xs-6">
                <div class="box box-solid">
                    <div class="box-header">
                        <h4 class="box-title" style="font-weight:bold;font-size:150%;">Loss Details - Current Shift
                        </h4>
                    </div>
                    <div class="box-body1" style="width: 100%; overflow: auto;">
                        <table id="tblLoss5min" class="table table-hover table-striped" style="font-size: 15px;border: 1px black solid;">
                            <thead>
                                <tr style="text-align: center;color:white; background-color: #FFC300;">
                                    <th style="text-align: center;border: 1px black solid;">
                                        Loss Description</th>
                                    <th style="text-align: center;border: 1px black solid;">
                                        Loss in %</th>
                                    <th style="text-align: center;border: 1px black solid;">
                                        Action To Be Taken</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyCurrShift">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </section>

    <div id="new-footer">
    </div>


    <script src="plugins/moment.js/moment.js"></script>
    <script src="javascripts/common.js"></script>
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="dist/js/jquery.knob.js"></script>
    <script src="plugins/Chart.min.js"></script>
<script src="../routes/lossdata.js"></script>
    <!-- <script src="plugins/chartjs/Chart1.min.js"></script> -->

    <script>

        var chart;

        var dd, mm, yyyy, h, min, s;
        var Sdate, Edate, preSdate, finalresultArr = [], ActualresultArr = [];
        var resultcurrInMinutes = 480;
        var linecolordata = [];
        var barcolordata = [];

        var Englansel, Hinlansel = true;
        var currentshiftdata, preshiftdata;
        var FinalTopLossArr = [];

        var Sdate='2021-09-30 07:00:00';
        var Edate='2021-09-30 15:00:00'
        $(document).ready(function () {
            if (window.localStorage.getItem('LangSel')) {
                var LangSel = window.localStorage.getItem('LangSel');
                if (LangSel == "HINDI") {
                    Hinlansel = true;
                    $('#btnEng').addClass('lanbtnrem');
                    $('#btnEng').removeClass('lanbtn');

                    $('#btnHin').addClass('lanbtn');
                    $('#btnHin').removeClass('lanbtnrem');
                }

                else {
                    Englansel = true;
                    $('#btnEng').addClass('lanbtn');
                    $('#btnEng').removeClass('lanbtnrem');

                    $('#btnHin').addClass('lanbtnrem');
                    $('#btnHin').removeClass('lanbtn');
                }

            }
            else {
                Hinlansel = true;
            }

            shift();

           // var idleInterval = setTimeout("RefreshPage()", 300000);

        });
        function RefreshPage() {
            location.reload();
        }

        $(".knoboee").knob({

            draw: function () {

                // "tron" case
                if (this.$.data('skin') == 'tron') {

                    var a = this.angle(this.cv)  // Angle
                        , sa = this.startAngle          // Previous start angle
                        , sat = this.startAngle         // Start angle
                        , ea                            // Previous end angle
                        , eat = sat + a                 // End angle
                        , r = true;

                    this.g.lineWidth = this.lineWidth;

                    this.o.cursor
                        && (sat = eat - 0.3)
                        && (eat = eat + 0.3);

                    if (this.o.displayPrevious) {
                        ea = this.startAngle + this.angle(this.value);
                        this.o.cursor
                            && (sa = ea - 0.3)
                            && (ea = ea + 0.3);
                        this.g.beginPath();
                        this.g.strokeStyle = this.previousColor;
                        this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false);
                        this.g.stroke();
                    }

                    this.g.beginPath();
                    this.g.strokeStyle = r ? this.o.fgColor : this.fgColor;
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false);
                    this.g.stroke();

                    this.g.lineWidth = 2;
                    this.g.beginPath();
                    this.g.strokeStyle = this.o.fgColor;
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false);
                    this.g.stroke();

                    return false;
                }
            }

        });


        $(".knobspeed").knob({

            draw: function () {

                // "tron" case
                if (this.$.data('skin') == 'tron') {

                    var a = this.angle(this.cv)  // Angle
                        , sa = this.startAngle          // Previous start angle
                        , sat = this.startAngle         // Start angle
                        , ea                            // Previous end angle
                        , eat = sat + a                 // End angle
                        , r = true;

                    this.g.lineWidth = this.lineWidth;

                    this.o.cursor
                        && (sat = eat - 0.3)
                        && (eat = eat + 0.3);

                    if (this.o.displayPrevious) {
                        ea = this.startAngle + this.angle(this.value);
                        this.o.cursor
                            && (sa = ea - 0.3)
                            && (ea = ea + 0.3);
                        this.g.beginPath();
                        this.g.strokeStyle = this.previousColor;
                        this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false);
                        this.g.stroke();
                    }

                    this.g.beginPath();
                    this.g.strokeStyle = r ? this.o.fgColor : this.fgColor;
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false);
                    this.g.stroke();

                    this.g.lineWidth = 2;
                    this.g.beginPath();
                    this.g.strokeStyle = this.o.fgColor;
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false);
                    this.g.stroke();

                    return false;
                }
            }

        });
        /* END JQUERY KNOB */


        function ShowENG() {
            $('#btnEng').addClass('lanbtn');
            $('#btnEng').removeClass('lanbtnrem');

            $('#btnHin').addClass('lanbtnrem');
            $('#btnHin').removeClass('lanbtn');

            Englansel = true;
            Hinlansel = false;
            localStorage.setItem('LangSel', "ENGLISH");

            location.reload();
            // DrawCurrShiftLineChart();
            // DrawPreShiftBarChart();
            // currshifttop3lossesTable(currentshiftdata);
        }
        function ShowHIN() {
            $('#btnEng').addClass('lanbtnrem');
            $('#btnEng').removeClass('lanbtn');

            $('#btnHin').addClass('lanbtn');
            $('#btnHin').removeClass('lanbtnrem');


            Englansel = false;
            Hinlansel = true;
            localStorage.setItem('LangSel', "HINDI");

            location.reload();

            // DrawCurrShiftLineChart();
            // DrawPreShiftBarChart();
            // currshifttop3lossesTable(currentshiftdata);
        }

        function shift() {
            var shiftVal;
            var today = new Date('2021-09-30 07:00:00.000');
            //var today = new Date('2020-12-11 07:00:00.000');
            var today = new Date();

            dd = today.getDate();
            mm = today.getMonth() + 1;
            yyyy = today.getFullYear();
            h = today.getHours();
            min = today.getMinutes();
            s = today.getSeconds();

            //Edate = yyyy + "-" + mm + "-" + dd + " " + h + ":" + min + ":" + s
            var datetimeformat = "Y-m-d H:i:s";
            Edate = format(today, datetimeformat);

            var currdatetime = Edate;

            var date = yyyy + "-" + mm + "-" + dd;
            //Shift value
            var shift1 = date + " " + "07:00:00";
            var shift2 = date + " " + "15:00:00";
            var shift3 = date + " " + "23:00:00";
            var midnight = date + " " + "23:59:59";
            var newday = new Date();
            newday.setDate(newday.getDate() - 1);
            var d = newday.getDate();
            var m = newday.getMonth() + 1;
            var y = newday.getFullYear();

            newday = y + "-" + m + "-" + d + " " + "23:00:00";

            if (new Date(Edate).valueOf() >= new Date(shift1).valueOf() &&
                new Date(Edate).valueOf() < new Date(shift2).valueOf()) {

                Sdate = shift1;
                shiftVal = "A";

            }
            else if (new Date(Edate).valueOf() >= new Date(shift2).valueOf() &&
                new Date(Edate).valueOf() < new Date(shift3).valueOf()) {
                Sdate = shift2;
                shiftVal = "B";
            }
            else if (new Date(Edate).valueOf() >= new Date(newday).valueOf() && new Date(Edate).valueOf() < new Date(shift1).valueOf()
                || new Date(Edate).valueOf() >= new Date(shift3).valueOf()) {
                if (new Date(Edate).valueOf() >= new Date(shift3).valueOf()
                    && new Date(Edate).valueOf() < new Date(midnight).valueOf()
                ) {
                    Sdate = shift3;
                    shiftVal = "C";
                }
                if (new Date(Edate).valueOf() >= new Date(newday).valueOf() && new Date(Edate).valueOf() < new Date(shift1).valueOf()) {
                    Sdate = newday;
                    shiftVal = "C";
                }
            }


            var dateArr = Edate.split(' ');
            var dateVal = dateArr[0];
            var time = dateArr[1];
            document.getElementById("lblShift").innerText = "Shift" + " " + shiftVal;
            document.getElementById("lblDate").innerText = dateVal;
            document.getElementById("lbltime").innerText = time;



            var Sdatetm = new Date(Sdate);
            Sdatetm.setHours(Sdatetm.getHours() + 8);
            var mm = Sdatetm.getMonth() + 1;
            Edate = Sdatetm.getFullYear() + "-" + mm + "-" + Sdatetm.getDate() + " " + Sdatetm.getHours() + ':' + Sdatetm.getMinutes() + ':' + Sdatetm.getSeconds();

            getCurrShiftCas2OEE();
            // LineSpeedStatus();//TEST

            var startTime = new Date(Sdate);
            var endTime = new Date(currdatetime);
            var difference = endTime.getTime() - startTime.getTime(); // This will give difference in milliseconds
            resultcurrInMinutes = Math.round(difference / 60000);
            console.log(resultcurrInMinutes);
        }

        function getCurrShiftCas2OEE() {
            var Sdate='2021-09-30 15:00:00';
            var Edate='2021-09-30 23:00:00'
            $.ajax({
                type: 'GET',
                url: '/getCas2OEE',
                data: {
                    Sdate: Sdate,
                    Edate: Edate
                },
                //async: false,
                success: function (result) {

                    if (result != null) {
                        debugger;
                        var currentshiftOEEdata = result.recordset;
                        if (currentshiftOEEdata.length > 0) {

                            var cascadeOEE = currentshiftOEEdata[0]["Cas2OEE"];
                            if (cascadeOEE != null) {
                                if (cascadeOEE > 100) {
                                    cascadeOEE = 100;
                                }

                                $('.knoboee').val(cascadeOEE).trigger('change');

                            }
                        }
                    }
                    getCurrShiftData();
                }
            });
        }

        function getCurrShiftData() {
            debugger;
            var Sdate='2021-09-30 15:00:00';
            var Edate='2021-09-30 23:00:00'
            $.ajax({
                type: 'GET',
                url: '/getlossesdatabasedonSetSpeed',
                data: {
                    sDate: Sdate,
                    eDate: Edate
                },
                //async: false,
                success: function (result) {

                    if (result != null) {
                        debugger;
                        currentshiftdata = result.recordset;
                        if (currentshiftdata.length > 0) {
                            currshifttop3lossesTable(currentshiftdata);
                        }
                    }
                    getPreShiftData();
                }
            });
        }

        function getPreShiftData() {
            debugger;

            var Sdatetm = new Date(Sdate);
            Sdatetm.setHours(Sdatetm.getHours() - 8);
            var mm = Sdatetm.getMonth() + 1;
            preSdate = Sdatetm.getFullYear() + "-" + mm + "-" + Sdatetm.getDate() + " " + Sdatetm.getHours() + ':' + Sdatetm.getMinutes() + ':' + Sdatetm.getSeconds();
            var Sdate='2021-09-30 23:00:00';
        var preSdate='2021-09-30 15:00:00'
            $.ajax({
                type: 'GET',
                url: '/getlossesdatabasedonSetSpeed',
                data: {
                    sDate: preSdate,
                    eDate: Sdate,
                    shift: "Previous"
                },
                // async: false,
                success: function (result) {
                    if (result != null) {
                        debugger;
                        preshiftdata = result.recordset;

                        if (preshiftdata.length > 0) {
                            DrawPreShiftBarChart();
                        }
                    }


                    LineSpeedGraphLast8Hrs();
                }
            });
        }

        function DrawPreShiftBarChart() {
            if (preshiftdata.length > 0) {
                var lables = [], Minutes = [], losscodes = [];
                for (t = 0; t < preshiftdata.length; t++) {
                    losscodes.push(preshiftdata[t]["LossCode"]);
                    if (Englansel)
                        lables.push(preshiftdata[t]["LossDescription"]);
                    else
                        lables.push(preshiftdata[t]["LossDescriptionHindi"]);

                    Minutes.push(preshiftdata[t]["cascadespeedlossmin"].toFixed(2));
                }

                var max = preshiftdata[0]["cascadespeedlossmin"];
                max = max + 140;

                chartjs(Minutes, lables, max, "barChart", losscodes);
            }
        }

        function currshifttop3lossesTable(currentshiftdata) {
            debugger;
            $("#tbodyCurrShift").empty();
            var flagcurr, totalspeed = 0;
            if (currentshiftdata.length > 0) {

                for (v = 0; v < currentshiftdata.length; v++) {

                    totalspeed = totalspeed + parseFloat(currentshiftdata[v].cascadespeedlossmin);
                }

                for (x = currentshiftdata.length - 1; x >= 0; x--) {
                    if (Englansel)
                        var currdesc = currentshiftdata[x].LossDescription;
                    else
                        var currdesc = currentshiftdata[x].LossDescriptionHindi;

                    var currspeedloss = currentshiftdata[x].cascadespeedlossmin;
                    var currspeedlosspercent = (parseFloat(currspeedloss) / parseFloat(totalspeed) * 100);

                    if (Englansel)
                        var curraction = currentshiftdata[x].Action;
                    else
                        var curraction = currentshiftdata[x].ActionHindi;

                    var row = '<tr>';
                    if ((x % 2) == 0) {
                        row += '<td style="background-color:#FEDFBB;">' + currdesc + "-" + currspeedloss.toFixed(2) + "Min" + '</td>';
                        row += '<td style="background-color:#FEDFBB;">' + currspeedlosspercent.toFixed(2) + "%" + '</td>';
                        row += '<td style="background-color:#FEDFBB;">' + curraction + '</td>';
                    }
                    else {
                        row += '<td style="background-color:#FEF3E5;">' + currdesc + "-" + currspeedloss.toFixed(2) + "Min" + '</td>';
                        row += '<td style="background-color:#FEF3E5;">' + currspeedlosspercent.toFixed(2) + "%" + '</td>';
                        row += '<td style="background-color:#FEF3E5;">' + curraction + '</td>';
                    }
                    row += '</tr>';
                    $('#tbodyCurrShift').append(row);


                }
            }

            // document.getElementById("speed").innerText = totalspeed.toFixed(2) + " Min";

            //show cascade speed
            // var cascadespeed = (totalspeed / (480 * 4))*100;//full shift time
            var cascadespeed = (totalspeed / (parseInt(resultcurrInMinutes) * 4)) * 100;

            cascadespeed = parseInt(cascadespeed).toFixed(0);

            if (cascadespeed > 100) {
                cascadespeed = 100;
            }

            $('.knobspeed').val(cascadespeed).trigger('change');


        }

        Date.prototype.toCISOString = function () {
            var tzo = -this.getTimezoneOffset(),
                dif = tzo >= 0 ? '+' : '-',
                pad = function (num) {
                    var norm = Math.floor(Math.abs(num));
                    return (norm < 10 ? '0' : '') + norm;
                };
            return this.getFullYear() +
                '-' + pad(this.getMonth() + 1) +
                '-' + pad(this.getDate()) +
                'T' + pad(this.getHours()) +
                ':' + pad(this.getMinutes()) +
                ':' + pad(this.getSeconds());// +
            // dif + pad(tzo / 60) +
            //':' + pad(tzo % 60);
        }

        Date.prototype.toCUTCString = function () {
            var tzo = 0,
                dif = tzo >= 0 ? '+' : '-',
                pad = function (num) {
                    var norm = Math.floor(Math.abs(num));
                    return (norm < 10 ? '0' : '') + norm;
                };
            return this.getUTCFullYear() +
                '-' + pad(this.getUTCMonth() + 1) +
                '-' + pad(this.getUTCDate()) +
                'T' + pad(this.getUTCHours()) +
                ':' + pad(this.getUTCMinutes()) +
                ':' + pad(this.getUTCSeconds());// +
            // dif + pad(tzo / 60) +
            //':' + pad(tzo % 60);
        }

        function LineSpeedStatus() {
            debugger;
            var Sdate='2021-09-30 15:00:00';
            var Edate='2021-09-30 23:00:00'
            //TEST
            //    Sdate='2020-11-29 06:00:00',
            //    Edate='2020-11-29 07:00:00'
            $.ajax({
                type: "get",
                url: "/lineSpeedStatus",
                dataType: "json",
                data: {
                    sDate: Sdate,
                    eDate: Edate
                },
                success: function (result) {
                    debugger;
                    if (result != null) {
                        debugger;
                        var Line8 = [], Line5 = [], Line6 = [], Line7 = [];
                        var data1 = result.recordset;

                        if (data1 != '') {
                            if (data1.length > 0) {

                                Line5 = data1.filter(function (el) {
                                    return el.line == "Line 1";
                                });

                                Line6 = data1.filter(function (el) {
                                    return el.line == "Line 2";
                                });

                                Line7 = data1.filter(function (el) {
                                    return el.line == "Line 3";
                                });

                                Line8 = data1.filter(function (el) {
                                    return el.line == "Line 4";
                                });

                                var stime = Sdate;
                                var etime = new Date();
                                //var etime=Edate;//TEST

                                var dt1 = new Date(stime);
                                var dt2 = new Date(etime);
                                var divcnt = (dt2.getTime() - dt1.getTime()) / 1000;
                                divcnt /= 60;
                                divcnt = Math.abs(Math.round(divcnt));
                                console.log("Total div count to add " + divcnt);

                                if (Line5.length > 0) {
                                    var totalsec = 0, totaldivadded = 0, remdivtoadd = 0;

                                    for (var i = 0; i < Line5.length; i++) {

                                        var timeinsec = Line5[i]["timeinsec"];
                                        var speedlossinsec = Line5[i]["speedlossinsec"];

                                        var runtimeinMin = (timeinsec - speedlossinsec) / 60;
                                        var speedlosstimeinMin = Line5[i]["speedlossinsec"] / 60;

                                        var status0actMin = Math.abs(Math.round(runtimeinMin));
                                        var status1actMin = Math.abs(Math.round(speedlosstimeinMin));

                                        totalsec += status0actMin;
                                        totalsec += status1actMin;

                                        for (var j = 0; j < status1actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'red';
                                                $('#btn1').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (status0actMin > 0) {
                                            for (var j = 0; j < status0actMin; j++) {
                                                if (totaldivadded < divcnt) {
                                                    var div = document.createElement('div');
                                                    div.id = "Progressdiv";
                                                    div.className = 'green';
                                                    $('#btn1').append(div);
                                                    totaldivadded++;
                                                }
                                            }
                                        }
                                        else {
                                            remdivtoadd += runtimeinMin;
                                        }


                                        if (i == 0) {
                                            var pretime = Sdate;
                                            var currtime = Line5[i]["starttime"];
                                            var currtimearr = currtime.split(".");
                                            currtime = currtimearr[0].replace("T", " ");

                                            var dt1 = new Date(pretime);
                                            var dt2 = new Date(currtime);
                                            var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                            diff /= 60;

                                            status0actMin = Math.abs(Math.round(diff));

                                            if (status0actMin <= 0) {
                                                remdivtoadd += diff;
                                            }

                                            totalsec += status0actMin;
                                        }
                                        else
                                            if (i > 0) {
                                                if (i == Line5.length - 1) {
                                                    var pretime = Line5[i]["endtime"];
                                                    var pretimearr = pretime.split(".");
                                                    pretime = pretimearr[0].replace("T", " ");
                                                    var currtime = new Date();
                                                    //var currtime=Edate;//TEST
                                                }
                                                else {
                                                    var pretime = Line5[i - 1]["endtime"];
                                                    var currtime = Line5[i]["starttime"];
                                                }

                                                var dt1 = new Date(pretime);
                                                var dt2 = new Date(currtime);
                                                var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                                diff /= 60;

                                                status0actMin = Math.abs(Math.round(diff));

                                                if (status0actMin <= 0) {
                                                    remdivtoadd += diff;
                                                }
                                                totalsec += status0actMin;
                                            }


                                        for (var j = 0; j < status0actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn1').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (totaldivadded < divcnt) {
                                            var remstatus0actMin = Math.abs(Math.round(remdivtoadd));

                                            if (i == Line5.length - 1) {
                                                remstatus0actMin = divcnt - totaldivadded;
                                            }

                                            for (var j = 0; j < remstatus0actMin; j++) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn1').append(div);

                                                remdivtoadd = 0;
                                                totaldivadded++;
                                            }
                                        }
                                    }

                                    console.log("Total Time Line5 " + totalsec);
                                    console.log("Total div Line5 " + totaldivadded);
                                }
                                else {
                                    var pretime = Sdate;
                                    var currtime = Edate;
                                    var dt1 = new Date(pretime);
                                    var dt2 = new Date(currtime);
                                    var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                    diff /= 60;

                                    var status0actMin = Math.abs(Math.round(diff));

                                    for (var j = 0; j < status0actMin; j++) {
                                        var div = document.createElement('div');
                                        div.id = "Progressdiv";
                                        div.className = 'lightgray';//'green';
                                        $('#btn1').append(div);
                                    }
                                }

                                if (Line6.length > 0) {
                                    var totalsec = 0, totaldivadded = 0, remdivtoadd = 0;
                                    for (var i = 0; i < Line6.length; i++) {

                                        var timeinsec = Line6[i]["timeinsec"];
                                        var speedlossinsec = Line6[i]["speedlossinsec"];

                                        var runtimeinMin = (timeinsec - speedlossinsec) / 60;
                                        var speedlosstimeinMin = Line6[i]["speedlossinsec"] / 60;

                                        var status0actMin = Math.abs(Math.round(runtimeinMin));
                                        var status1actMin = Math.abs(Math.round(speedlosstimeinMin));

                                        totalsec += status0actMin;
                                        totalsec += status1actMin;

                                        for (var j = 0; j < status1actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'red';
                                                $('#btn2').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (status0actMin > 0) {
                                            for (var j = 0; j < status0actMin; j++) {
                                                if (totaldivadded < divcnt) {
                                                    var div = document.createElement('div');
                                                    div.id = "Progressdiv";
                                                    div.className = 'green';
                                                    $('#btn2').append(div);
                                                    totaldivadded++;
                                                }
                                            }
                                        }
                                        else {
                                            remdivtoadd += runtimeinMin;
                                        }

                                        if (i == 0) {
                                            var pretime = Sdate;
                                            var currtime = Line6[i]["starttime"];
                                            var currtimearr = currtime.split(".");
                                            currtime = currtimearr[0].replace("T", " ");

                                            var dt1 = new Date(pretime);
                                            var dt2 = new Date(currtime);
                                            var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                            diff /= 60;

                                            status0actMin = Math.abs(Math.round(diff));
                                            if (status0actMin <= 0) {
                                                remdivtoadd += diff;
                                            }
                                            totalsec += status0actMin;
                                        }
                                        else
                                            if (i > 0) {
                                                if (i == Line6.length - 1) {
                                                    var pretime = Line6[i]["endtime"];
                                                    var pretimearr = pretime.split(".");
                                                    pretime = pretimearr[0].replace("T", " ");
                                                    var currtime = new Date();
                                                    //var currtime=Edate;//TEST
                                                }
                                                else {
                                                    var pretime = Line6[i - 1]["endtime"];
                                                    var currtime = Line6[i]["starttime"];
                                                }

                                                var dt1 = new Date(pretime);
                                                var dt2 = new Date(currtime);
                                                var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                                diff /= 60;

                                                status0actMin = Math.abs(Math.round(diff));
                                                if (status0actMin <= 0) {
                                                    remdivtoadd += diff;
                                                }
                                                totalsec += status0actMin;
                                            }

                                        for (var j = 0; j < status0actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn2').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (totaldivadded < divcnt) {
                                            var remstatus0actMin = Math.abs(Math.round(remdivtoadd));

                                            if (i == Line6.length - 1) {
                                                remstatus0actMin = divcnt - totaldivadded;
                                            }
                                            for (var j = 0; j < remstatus0actMin; j++) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn2').append(div);

                                                remdivtoadd = 0;
                                                totaldivadded++;
                                            }
                                        }
                                    }
                                    console.log("Total Time Line6 " + totalsec);
                                    console.log("Total div Line6 " + totaldivadded);
                                }
                                else {
                                    var pretime = Sdate;
                                    var currtime = Edate;
                                    var dt1 = new Date(pretime);
                                    var dt2 = new Date(currtime);
                                    var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                    diff /= 60;

                                    var status0actMin = Math.abs(Math.round(diff));

                                    for (var j = 0; j < status0actMin; j++) {
                                        var div = document.createElement('div');
                                        div.id = "Progressdiv";
                                        div.className = 'lightgray';//'green';
                                        $('#btn2').append(div);
                                    }
                                }

                                if (Line7.length > 0) {
                                    var totalsec = 0, totaldivadded = 0, remdivtoadd = 0;
                                    for (var i = 0; i < Line7.length; i++) {

                                        var timeinsec = Line7[i]["timeinsec"];
                                        var speedlossinsec = Line7[i]["speedlossinsec"];

                                        var runtimeinMin = (timeinsec - speedlossinsec) / 60;
                                        var speedlosstimeinMin = Line7[i]["speedlossinsec"] / 60;

                                        var status0actMin = Math.abs(Math.round(runtimeinMin));
                                        var status1actMin = Math.abs(Math.round(speedlosstimeinMin));

                                        totalsec += status0actMin;
                                        totalsec += status1actMin;

                                        for (var j = 0; j < status1actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'red';
                                                $('#btn3').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (status0actMin > 0) {
                                            for (var j = 0; j < status0actMin; j++) {
                                                if (totaldivadded < divcnt) {
                                                    var div = document.createElement('div');
                                                    div.id = "Progressdiv";
                                                    div.className = 'green';
                                                    $('#btn3').append(div);
                                                    totaldivadded++;
                                                }
                                            }
                                        }
                                        else {
                                            remdivtoadd += runtimeinMin;
                                        }
                                        if (i == 0) {
                                            var pretime = Sdate;
                                            var currtime = Line7[i]["starttime"];
                                            var currtimearr = currtime.split(".");
                                            currtime = currtimearr[0].replace("T", " ");

                                            var dt1 = new Date(pretime);
                                            var dt2 = new Date(currtime);
                                            var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                            diff /= 60;

                                            status0actMin = Math.abs(Math.round(diff));
                                            if (status0actMin <= 0) {
                                                remdivtoadd += diff;
                                            }
                                            totalsec += status0actMin;
                                        }
                                        else
                                            if (i > 0) {
                                                if (i == Line7.length - 1) {
                                                    var pretime = Line7[i]["endtime"];
                                                    var pretimearr = pretime.split(".");
                                                    pretime = pretimearr[0].replace("T", " ");
                                                    var currtime = new Date();
                                                    //var currtime=Edate;//TEST
                                                }
                                                else {
                                                    var pretime = Line7[i - 1]["endtime"];
                                                    var currtime = Line7[i]["starttime"];
                                                }

                                                var dt1 = new Date(pretime);
                                                var dt2 = new Date(currtime);
                                                var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                                diff /= 60;

                                                status0actMin = Math.abs(Math.round(diff));
                                                if (status0actMin <= 0) {
                                                    remdivtoadd += diff;
                                                }
                                                totalsec += status0actMin;
                                            }

                                        for (var j = 0; j < status0actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn3').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (totaldivadded < divcnt) {
                                            var remstatus0actMin = Math.abs(Math.round(remdivtoadd));

                                            if (i == Line7.length - 1) {
                                                remstatus0actMin = divcnt - totaldivadded;
                                            }
                                            for (var j = 0; j < remstatus0actMin; j++) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn3').append(div);

                                                remdivtoadd = 0;
                                                totaldivadded++;
                                            }
                                        }
                                    }
                                    console.log("Total Time Line7 " + totalsec);
                                    console.log("Total div Line7 " + totaldivadded);
                                }
                                else {
                                    var pretime = Sdate;
                                    var currtime = Edate;
                                    var dt1 = new Date(pretime);
                                    var dt2 = new Date(currtime);
                                    var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                    diff /= 60;

                                    var status0actMin = Math.abs(Math.round(diff));

                                    for (var j = 0; j < status0actMin; j++) {
                                        var div = document.createElement('div');
                                        div.id = "Progressdiv";
                                        div.className = 'lightgray';//'green';
                                        $('#btn3').append(div);
                                    }

                                }

                                if (Line8.length > 0) {
                                    var totalsec = 0, totaldivadded = 0, remdivtoadd = 0;
                                    for (var i = 0; i < Line8.length; i++) {

                                        var timeinsec = Line8[i]["timeinsec"];
                                        var speedlossinsec = Line8[i]["speedlossinsec"];

                                        var runtimeinMin = (timeinsec - speedlossinsec) / 60;
                                        var speedlosstimeinMin = Line8[i]["speedlossinsec"] / 60;

                                        var status0actMin = Math.abs(Math.round(runtimeinMin));
                                        var status1actMin = Math.abs(Math.round(speedlosstimeinMin));

                                        totalsec += status0actMin;
                                        totalsec += status1actMin;

                                        for (var j = 0; j < status1actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'red';
                                                $('#btn4').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (status0actMin > 0) {
                                            for (var j = 0; j < status0actMin; j++) {
                                                if (totaldivadded < divcnt) {
                                                    var div = document.createElement('div');
                                                    div.id = "Progressdiv";
                                                    div.className = 'green';
                                                    $('#btn4').append(div);
                                                    totaldivadded++;
                                                }
                                            }
                                        }
                                        else {
                                            remdivtoadd += runtimeinMin;
                                        }

                                        if (i == 0) {
                                            var pretime = Sdate;
                                            var currtime = Line8[i]["starttime"];
                                            var currtimearr = currtime.split(".");
                                            currtime = currtimearr[0].replace("T", " ");

                                            var dt1 = new Date(pretime);
                                            var dt2 = new Date(currtime);
                                            var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                            diff /= 60;

                                            status0actMin = Math.abs(Math.round(diff));
                                            if (status0actMin <= 0) {
                                                remdivtoadd += diff;
                                            }
                                            totalsec += status0actMin;
                                        }
                                        else
                                            if (i > 0) {
                                                if (i == Line8.length - 1) {
                                                    var pretime = Line8[i]["endtime"];
                                                    var pretimearr = pretime.split(".");
                                                    pretime = pretimearr[0].replace("T", " ");
                                                    var currtime = new Date();
                                                    //var currtime=Edate;//TEST
                                                }
                                                else {
                                                    var pretime = Line8[i - 1]["endtime"];
                                                    var currtime = Line8[i]["starttime"];
                                                }

                                                var dt1 = new Date(pretime);
                                                var dt2 = new Date(currtime);
                                                var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                                diff /= 60;

                                                status0actMin = Math.abs(Math.round(diff));
                                                if (status0actMin <= 0) {
                                                    remdivtoadd += diff;
                                                }
                                                totalsec += status0actMin;
                                            }

                                        for (var j = 0; j < status0actMin; j++) {
                                            if (totaldivadded < divcnt) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn4').append(div);
                                                totaldivadded++;
                                            }
                                        }

                                        if (totaldivadded < divcnt) {
                                            var remstatus0actMin = Math.abs(Math.round(remdivtoadd));

                                            if (i == Line8.length - 1) {
                                                remstatus0actMin = divcnt - totaldivadded;
                                            }
                                            for (var j = 0; j < remstatus0actMin; j++) {
                                                var div = document.createElement('div');
                                                div.id = "Progressdiv";
                                                div.className = 'green';
                                                $('#btn4').append(div);

                                                remdivtoadd = 0;
                                                totaldivadded++;
                                            }
                                        }
                                    }
                                    console.log("Total Time Line8 " + totalsec);
                                    console.log("Total div Line8 " + totaldivadded);
                                }
                                else {
                                    var pretime = Sdate;
                                    var currtime = Edate;
                                    var dt1 = new Date(pretime);
                                    var dt2 = new Date(currtime);
                                    var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                                    diff /= 60;

                                    var status0actMin = Math.abs(Math.round(diff));

                                    for (var j = 0; j < status0actMin; j++) {
                                        var div = document.createElement('div');
                                        div.id = "Progressdiv";
                                        div.className = 'lightgray';//'green';
                                        $('#btn4').append(div);
                                    }

                                }

                            }
                        }

                    }
                }
            });
        }

        function LineSpeedGraphLast8Hrs() {
            debugger;
            var today = new Date('2021-09-30 07:00:00.000');
            //var today = new Date('2020-12-11 17:00:00.000');
            var today = new Date();

            dd = today.getDate();
            mm = today.getMonth() + 1;
            yyyy = today.getFullYear();
            h = today.getHours();
            min = today.getMinutes();
            s = today.getSeconds();

            var currEdate = yyyy + "-" + mm + "-" + dd + " " + h + ":" + min + ":" + s
            var currEdate='2021-09-30 23:00:00';
       
            $.ajax({
                type: 'GET',
                url: '/getlast8hrslossesdata',
                data: {
                    eDate: currEdate
                },
                // async: false,
                success: function (result) {
                    if (result != null) {
                        var data = result.recordset;
                        if (data.length > 0) {
                            FinalTopLossArr = [];

                            // var TotalMax = [], TotalLossDescp = [];
                            var lossdata = [], TotalPer = [];
                            var lossdataArray = data;

                            var lineArray = [], flags = [];
                            for (var m = 0; m < lossdataArray.length; m++) {
                                if (flags[lossdataArray[m].WorkcellDesc]) continue;
                                flags[lossdataArray[m].WorkcellDesc] = true;
                                lineArray.push(lossdataArray[m].WorkcellDesc);

                            }
                            for (var n = 0; n < lineArray.length; n++) {
                                var line1 = lineArray[n];

                                lossdata = lossdataArray.filter(function (el) {
                                    return el.WorkcellDesc == line1;
                                });

                                var currentlosscode = 0, finallosscode = 0, lossdesc;
                                var lossduration = 0, lossstarttime = 0, lossendtime = 0, WorkcellDesc = 0, lossDesc = 0;
                                var lossdataarr = [], Action = [];

                                lossdataarr = lossdata;
                                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                var count = lossdataarr.length;


                                var flags = [], code = [], losstime = [], codeloss = [];
                                // var totallossduration=0;

                                for (var z = 0; z < count; z++) {

                                    if (flags[lossdataarr[z].losscode])
                                        continue;

                                    flags[lossdataarr[z].losscode] = true;
                                    code.push(lossdataarr[z].losscode);

                                }

                                var sepratedarr = [], linearr = [];
                                for (var k = 0; k < code.length; k++) {
                                    var val = code[k];

                                    sepratedarr = lossdataarr.filter(function (el) {
                                        return el.losscode == val;
                                    });
                                    //  debugger;
                                    var hrmindata = [], sephrmindata = [], hrflags = [], hourarr = [];

                                    for (var y = 0; y < sepratedarr.length; y++) {

                                        if (hrflags[new Date(sepratedarr[y].lossstarttime.replace('Z', '')).getHours()])
                                            continue;

                                        hrflags[new Date(sepratedarr[y].lossstarttime.replace('Z', '')).getHours()] = true;
                                        hourarr.push(new Date(sepratedarr[y].lossstarttime.replace('Z', '')).getHours());

                                    }

                                    for (n1 = 0; n1 < hourarr.length; n1++) {
                                        var hour = 0, minute = 0, second = 0, totalsumSecs = 0, finalsumSec = 0.0;
                                        var valhour = hourarr[n1];
                                        sephrmindata = sepratedarr.filter(function (el) {
                                            return new Date(el.lossstarttime.replace('Z', '')).getHours() == valhour;
                                        });

                                        for (var m = 0; m < sephrmindata.length; m++) {
                                            var totalsumSecs = sephrmindata[m].lossduration;

                                            finalsumSec += totalsumSecs;
                                        }


                                        FinalTopLossArr.push({
                                            "finalsumMin": parseFloat(finalsumSec / 60).toFixed(2),
                                            "hour": valhour,
                                            "lossdesc": sepratedarr[0].lossdesc,
                                            "lossdeschindi": sepratedarr[0].LossDescriptionHindi,
                                            "losscode": val,
                                            "WorkcellDesc": sepratedarr[0].WorkcellDesc,
                                        });
                                    }
                                }
                            }

                            DrawCurrShiftLineChart();
                        }
                    }
                    LineSpeedStatus();
                }
            });

        }

        function DrawCurrShiftLineChart() {
            var sflags = [], sHour = [], lables = [], xflags = [], xcode = [];
            for (t = 0; t < FinalTopLossArr.length; t++) {
                if (xflags[FinalTopLossArr[t].losscode])
                    continue;

                xflags[FinalTopLossArr[t].losscode] = true;
                xcode.push(FinalTopLossArr[t].losscode);
            }

            var allarr = [], allfinalarr = [], lables = [];
            for (var j = 0; j < xcode.length; j++) {
                var yArr = [];
                var cd = xcode[j];

                var descres = FinalTopLossArr.filter(ro => String(ro.losscode) == cd);
                if (descres.length > 0) {
                    if (Englansel)
                        lables.push(descres[0]["lossdesc"]);
                    else
                        lables.push(descres[0]["lossdeschindi"]);
                }

                var grouped = [];
                descres.forEach(function (a) {
                    if (!this[a.hour]) {
                        this[a.hour] = { hour: a.hour, lossdesc: a.lossdesc, losscode: a.losscode, finalsumMin: 0, count: 1 };
                        grouped.push(this[a.hour]);
                    }
                    else {
                        this[a.hour].count++;
                    }
                    // this[a.hour].losscode = (+this[a.hour].losscode + +a['losscode']);
                    // this[a.hour].lossdesc = (+this[a.hour].lossdesc + +a['lossdesc']);
                    this[a.hour].finalsumMin = (+this[a.hour].finalsumMin + +a['finalsumMin']);

                }, Object.create(null));

                for (t1 = 0; t1 < grouped.length; t1++) {

                    if (sflags[grouped[t1].hour])
                        continue;

                    sflags[grouped[t1].hour] = true;
                    sHour.push(grouped[t1].hour);
                }
                sHour.sort(function (a, b) {
                    if (a != 23)
                        return a - b;
                });

                for (var c = 0; c < sHour.length; c++) {
                    var hr = sHour[c];
                    var res = grouped.filter(ro => String(ro.hour) == hr);
                    if (res.length > 0) {
                        yArr.push(res[0]["finalsumMin"].toFixed(2));
                    }
                    else {
                        yArr.push(0);
                    }
                }
                allfinalarr.push(yArr);
            }

            linechartjs(sHour, allfinalarr, lables, "myChart", xcode);
        }

        var linechart;
        function linechartjs(xAxis, yAxis, lables, CanvasId, losscodes) {
            debugger;

            //var color = ['red', 'black', 'blue', 'orange', 'pink', 'yellow', 'voilet', 'brown', '#FF0000', '#008000', '#2F9AEA'];

            setchartcolors(losscodes, "line");

            if (linechart) {
                linechart.destroy();
            }

            Chart.defaults.global.defaultFontFamily = "Lato";
            Chart.defaults.global.defaultFontSize = 12;
            var data = []
            for (var r = 0; r < yAxis.length; r++) {
                data[r] = {
                    label: lables[r],
                    data: yAxis[r],
                    lineTension: 0,
                    fill: false,
                    borderColor: linecolordata[r]//color[r]
                };
            }


            var speedData = {
                labels: xAxis,
                datasets: data
            };

            var chartOptions = {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        boxWidth: 80,
                        fontColor: 'black'
                    }
                }
            };

            linechart = new Chart(document.getElementById(CanvasId), {
                type: 'line',
                data: speedData,
                options: chartOptions
            });
        }


        function chartjs(Minutes, lables, max, CanvasId, losscodes) {
            debugger;

            setchartcolors(losscodes, "bar");

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(document.getElementById(CanvasId), {

                type: 'bar',
                data: {
                    labels: lables,
                    datasets: [
                        {
                            //label: "Losses",
                            backgroundColor: barcolordata,//"#3c8dbc",
                            // pointBackgroundColor: colorArray,
                            // borderColor: colorArray,
                            fill: false,
                            data: Minutes
                        }
                    ]
                },
                options: {
                    legend: { display: false },
                    // title: {
                    //     display: true,
                    //     text: 'OPE Details',
                    //     fontSize: 16
                    // },
                    "hover": {
                        "animationDuration": 0
                    },
                    // "animation": {
                    //     "duration": 1,
                    //     "onComplete": function () {
                    //         var chartInstance = this.chart,
                    //             ctx = chartInstance.ctx;

                    //         ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                    //         ctx.textAlign = 'center';
                    //         ctx.textBaseline = 'bottom';
                    //         ctx.fontSize = '12';

                    //         this.data.datasets.forEach(function (dataset, i) {
                    //             var meta = chartInstance.controller.getDatasetMeta(i);
                    //             meta.data.forEach(function (bar, index) {
                    //                 var data = dataset.data[index];
                    //                 ctx.fillText(data, bar._model.x, bar._model.y - 5);
                    //             });
                    //         });
                    //     }
                    // },
                    scales: {
                        xAxes: [{
                            gridLines: {
                                display: true
                            },
                            ticks: {
                                autoSkip: true,
                                //maxTicksLimit: 20
                            },
                            scaleLabel: {
                                //display: true,
                                // labelString: 'Time',
                                // fontSize: 16
                            }

                        }],
                        yAxes: [{
                            gridLines: {
                                display: false
                            },
                            scaleLabel: {
                                display: true,
                                labelString: "Minutes",
                                fontSize: 16
                            }
                            ,
                            ticks: {
                                max: max,
                                min: 0,
                                // stepSize: 20
                            }
                        }]
                    },

                }
            });
            chart.render();
        }


        function setchartcolors(losscodes, chartname) {
            var colordata = [];
            for (var r = 0; r < losscodes.length; r++) {
                if (losscodes[r] == 5508)
                    colordata.push('brown');
                else if (losscodes[r] == 5501)
                    colordata.push('pink');
                else if (losscodes[r] == 5502)
                    colordata.push('voilet');
                else if (losscodes[r] == 5504)
                    colordata.push('black');
                else if (losscodes[r] == 5505)
                    colordata.push('blue');
                else if (losscodes[r] == 5507)
                    colordata.push('orange');
                else if (losscodes[r] == 5511)
                    colordata.push('yellow');
                else if (losscodes[r] == 5509)
                    colordata.push('green');
                else if (losscodes[r] == 5512)
                    colordata.push('grey');
                else if (losscodes[r] == 5513)
                    colordata.push('purple');
                else if (losscodes[r] == 5514)
                    colordata.push('teal');
                else if (losscodes[r] == 5503)
                    colordata.push('chartreuse');
                else if (losscodes[r] == 5515)
                    colordata.push('cadetBlue');
                else if (losscodes[r] == 5516)
                    colordata.push('aqua');
                else if (losscodes[r] == 9001)
                    colordata.push('darkMagenta');
                else if (losscodes[r] == 6507)
                    colordata.push('chocolate');
                else if (losscodes[r] == 6511)
                    colordata.push('darkTurquoise');
                else if (losscodes[r] == 5510)
                    colordata.push('red');

                if (chartname == "bar")
                    barcolordata = colordata;
                else if (chartname == "line")
                    linecolordata = colordata;
            }
        }

    </script>
    <br>
    <br>
    <script>

        $("#new-footer").load("footer.html");
    </script>

</body>

</html>