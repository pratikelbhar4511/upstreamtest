<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Mint FDI</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.5 -->


</head>

<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>

<header class="main-header">

  <!-- Logo -->
  <a href="index.html" class="logo">

    <span class="logo-mini"><img src="dist/img/HUL.png" height="40" width="40"></span>
    <!-- logo for regular state and mobile devices -->
    <span class="logo-lg"> <img src="dist/img/HUL.png" height="50" width="50"> </span>

  </a>




  <!-- Header Navbar: style can be found in header.less -->
  <nav class="navbar navbar-static-top" role="navigation" style="background-color: #367fa9;">
    <!-- Sidebar toggle button-->
    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
      <span class="sr-only">Toggle navigation</span>
    </a>

    <!-- Navbar Right Menu -->
    <div class="navbar-custom-menu">
      <ul class="nav navbar-nav">
        <!-- Messages: style can be found in dropdown.less-->

        <!-- User Account: style can be found in dropdown.less -->
        <li class="dropdown user user-menu">

          <a href="#" class="dropdown-toggle" data-toggle="dropdown">

            <!-- <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image"> -->

            <span class="hidden-xs" id="userName">

            </span>

          </a>
          <ul class="dropdown-menu" style="width: 100px;">
            <!-- User image -->

            <!-- Menu Body -->

            <!-- Menu Footer-->
            <li class="user-footer">

              <div class="pull-left" style="display:none">
                <a href="#myModal" class="btn btn-default btn-flat" data-toggle="modal" data-target="#myModal">Change
                  Password</a>
              </div>
              <div class="pull-right">
                <a href="#" class="btn btn-default btn-flat" onclick="signout()">Sign out</a>

              </div>
            </li>
          </ul>

        </li>
        <!-- Control Sidebar Toggle Button -->
        <li>
          <span class="logo-lg"> <img src="dist/img/MintFDI.png" height="40" width="60" style="margin-right: 5%;">
          </span>

        </li>
      </ul>
    </div>

  </nav>
</header>
<!-- Left side column. contains the logo and sidebar -->
<aside class="main-sidebar">
  <!-- sidebar: style can be found in sidebar.less -->
  <section class="sidebar">
    <ul class="sidebar-menu">
      <!-- <li class="header">MAIN NAVIGATION</li> -->
      <li class="header"></li>
      <li class="active treeview">
        <a href="#">
          <i class="fa fa-dashboard"></i> <span>Dashboard</span> <i class="fa fa-angle-left pull-right"></i>
        </a>

        <ul class="treeview-menu">
          <li class="active" id="view_li"><a href="Dashboard.html"><i class="fa fa-circle-o"></i>Live Loss Dashboard</a>
          </li>
		  
		   <li class="active" id="RotatorBar_li"><a href=""><i class="fa fa-circle-o"></i>Rotator Dashboard</a>
          </li>
          <li class="active" id="loss_li"><a href="LossRegister.html"><i class="fa fa-circle-o"></i>Loss Register</a>
          </li>
          <li class="active" id="user_li"><a href="UserRegister.html"><i class="fa fa-circle-o"></i>User Management</a>
          </li>
          <li class="active" id="update_li"><a href="UpdateLossRegister.html"><i class="fa fa-circle-o"></i>Update Losses
              </a></li>
          <li class="active" id="pareto_li"><a href="ParetoChart.html"><i class="fa fa-circle-o"></i>ParetoChart</a>
          </li>
          <li class="active" id="pie_li"><a href="PieChart.html"><i class="fa fa-circle-o"></i>PieChart Dashboard</a>
          </li>
          <li class="active" id="speed_li"><a href="SpeedLossDashboard.html"><i class="fa fa-circle-o"></i>Speed Loss Dashboard</a>
          </li>
		  <li class="active" id="shop_li"><a href="ShopFloorDashBoard.html"><i class="fa fa-circle-o"></i>Shop Floor Dashboard</a>
          </li>
        </ul>
      </li>
  </section>
  <!-- /.sidebar -->
</aside>

<!-- Change Password popup-->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalCreate">Change Password</h4>
      </div>
      <div class="modal-body">
        <div class="box-body" style="width: 100%;">
          <div>
            <div class="form-group">
              <h4>
                <p><b>Enter new password below to reset password.</b></p>
              </h4>
              <br />
              <input id="txtNewPass" type="password" style="width: 90%;" placeholder="Please enter new password" />
              <span>&nbsp;
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">

        <button id="btn_password" class="btn btn-primary" onclick="updatePassword()">Submit</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

      </div>
    </div>

  </div>
</div>

<script>
  $(document).ready(function () {

    //clear local storage(session) after 1 hour
    // var hours = 1;//0.0625;//24; // Reset when storage is more than 1hour
    // var now = new Date().getTime();
    // var setupTime = localStorage.getItem('setupTime');

    // if (setupTime != null) {
    //   if (now - setupTime > hours * 60 * 60 * 1000) {
    //     localStorage.clear();
    //     window.location.href = "/index.html";
    //   }

    // }

    // if (window.localStorage.getItem('user_key')) {
    //   var data = window.localStorage.getItem('user_key');
    //   document.getElementById("userName").innerHTML = data;
    // }
    // else {
    //   data = "none";
    //   signout();
    // }

    // if (window.localStorage.getItem('role_key')) {
    //   var role_session = window.localStorage.getItem('role_key');

    //   if (role_session == "Operator") {
    //     document.getElementById("user_li").style.display = "none";
    //     document.getElementById("loss_li").style.display = "none";

    //   }
    // }
    // else {
    //   role_session = "none";
    //   window.location.href = "/index.html";
    // }


    $("#RotatorBar_li").click(function () {
      var n1 = window.location.href;
      var path = n1.split('/');
      var locationarr = path[2].split(':');
      var location = locationarr[0] + ":64682/RotatorDashboard.html";
      window.open("http://" + location, "_blank"); //http://145.17.32.151:64682/RotatorDashboard.html

});
  });



  function updatePassword() {


    var email = window.localStorage.getItem('user_key');
    var password = document.getElementById("txtNewPass").value;


    if (password == "" || password == null) {

      alert("New Password Field is missing.. Please Enter Data.");
    }
    else {

      $.post("/updatePassword", { password: password, email: email }, function (data) {

        if (data["rowCount"] == 1) {

          $("#myModal").modal('hide');
          alert("Password Updated successfully...");

          signout();
        }
        else {
          alert("Password Updation Failed");
        }

      });

    }

  }


  function signout() {

    $.get("/logout", function (data) {
      debugger;

      localStorage.clear();

      window.location.href = "/index.html";

    });

  }
</script>

</html>