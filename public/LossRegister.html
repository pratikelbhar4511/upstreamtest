<!DOCTYPE html>
<html>
<div id="new-header">
</div>

<body onload="getlosses()" class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">


        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    Loss Management
                </h1>
            </section>

            <!-- Main content -->

            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">

                            <div class="box-header">


                            </div>
                            <div class="box-tools pull-right">
                                <img src="dist/img/icons8-plus-40.png" id="openPopup" data-toggle="modal"
                                    onclick="ShowAddLoss()">
                            </div>

                            <div class="box-body">

                                <div class="form-horizontal">
                                    <div class="box-body">


                                        <div class="box-body table-responsive no-padding">
                                            <table id="tblLossData" class="table table-hover">
                                                <thead>

                                                    <tr>
                                                        <td id="row-1"></td>
                                                        <td id="row-2" align="Left"></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Sr. No.</th>
                                                        <th>Loss Code</th>
                                                        <th>Loss Description</th>
                                                        <th>Action</th>
                                                        <th>Loss Description(Hindi)</th>
                                                        <th>Action(Hindi)</th>
                                                    </tr>
                                                </thead>

                                                <tbody id="tbodyLossid">
                                                    <tr>

                                                    </tr>
                                                </tbody>

                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div id="add_project_frm" class="form-horizontal">
                <div class="box-body">
                    <div class="modal fade" id="createModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog" role="document" style="width:30%">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="myModalCreate">Loss Register</h4>
                                </div>

                                <div class="modal-body">

                                    <div class="box-body">
                                        <p class="col-md-12" id="project_no_Error" style="color: red;"></p>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Code</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtlosscode" id='txtlosscode'
                                                            placeholder="Enter Loss Code" class="form-control"
                                                            style="width: 200px;" required />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Description</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtlossdesc" id='txtlossdesc'
                                                            placeholder="Enter Loss Description" class="form-control"
                                                            style="width: 200px;" required />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Action</label>
                                                    <div class="col-sm-6">
                                                        <textarea  name="txtaction" id='txtaction'
                                                            placeholder="Enter Action" class="form-control"
                                                            style="width: 200px;" required></textarea>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Description(Hindi)</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtlossdeschindi" id='txtlossdeschindi'
                                                            placeholder="Enter Loss Description in hindi" class="form-control"
                                                            style="width: 200px;" />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Action(Hindi)</label>
                                                    <div class="col-sm-6">
                                                        <textarea  name="txtactionhindi" id='txtactionhindi'
                                                            placeholder="Enter Action in hindi" class="form-control"
                                                            style="width: 200px;"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label id="lblerr" name="lblcpass" style="color:red"></label>
                                            </div>

                                        </div>


                                        <div class="modal-footer">
                                            <button id="btn_add" name="ADD" class="btn btn-primary col-sm-offset-4"
                                                onclick="sendDataToInsert()">SUBMIT</button>

                                            <button type="button" class="btn btn-primary"
                                                data-dismiss="modal">Close</button>
                                        </div>

                                    </div>

                                </div>
                            </div>

                        </div>


                    </div>
                </div>
            </div>


            <!-- create Modal popup for update site register -->
            <div id="update" class="form-horizontal">
                <div class="box-body">
                    <div class="modal fade" id="UpdateModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="myModalCreate">Loss Register</h4>
                                </div>

                                <div class="modal-body">

                                    <div class="box-body">
                                        <p class="col-md-12" id="project_no_Error" style="color: red;"></p>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Code</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtupdatelosscode"
                                                            id="txtupdatelosscode" placeholder="Enter Loss Code"
                                                            class="form-control" style="width: 200px;" required
                                                            readonly />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Description</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtupdatelossdesc"
                                                            id='txtupdatelossdesc' placeholder="Enter Loss Description"
                                                            class="form-control" style="width: 200px;" required />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Action</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtupdateaction"
                                                            id='txtupdateaction' placeholder="Enter Action"
                                                            class="form-control" style="width: 200px;" required />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Loss Description(Hindi)</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtupdatelossdeschindi"
                                                            id='txtupdatelossdeschindi' placeholder="Enter Loss Description in hindi"
                                                            class="form-control" style="width: 200px;"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Action(Hindi)</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" name="txtupdateactionhindi"
                                                            id='txtupdateactionhindi' placeholder="Enter Action in hindi"
                                                            class="form-control" style="width: 200px;"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label id="lblerr" name="lblupdatecpass" style="color:red"></label>
                                            </div>

                                        </div>


                                        <div class="modal-footer">

                                            <button id="btn_delete" name="DELETE"
                                                class="btn btn-primary col-sm-offset-4"
                                                onclick="sendDataToDelete()">DELETE</button>

                                            <button id="btn_add" name="ADD" class="btn btn-primary col-sm-offset-4"
                                                onclick="sendDataToUpdate()">SUBMIT</button>

                                            <button type="button" class="btn btn-primary"
                                                data-dismiss="modal">Close</button>
                                        </div>

                                    </div>

                                </div>
                            </div>

                        </div>


                    </div>
                </div>
            </div>
        </div><!-- /.content-wrapper -->
    </div>

    <div id="new-footer">
    </div>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
                folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <!-- Common.js -->
    <script src="javascripts/common.js"></script>

    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>

    <!-- Sparkline -->
    <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
    <!-- jvectormap -->
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <!-- SlimScroll 1.3.0 -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>

    <script>

        //Global Variables
        var selectedrow;

        function getlosses() {

            $("#tbodySiteid").empty();

            $.get("/getlosses", function (data) {

                if (data != null) {
                    var response = data.recordset;
                    if (response.length > 0) {
                        $.each(response, function (i, d) {

                            console.log(i);

                            if(d["LossDescriptionHindi"]==null)
                            d["LossDescriptionHindi"]="-";

                            if(d["ActionHindi"]==null)
                            d["ActionHindi"]="-";

                            var row = '<tr>';
                            row += '<td></td>';
                            row += '<td>' + d["LossCode"] + '</td>';
                            row += '<td>' + d["LossDescription"] + '</td>';
                            row += '<td>' + d["Action"] + '</td>';
                            row += '<td>' + d["LossDescriptionHindi"] + '</td>';
                            row += '<td>' + d["ActionHindi"] + '</td>';
                            row += '<td>' + '<button class="btn btn-primary" onclick="return showpopup(this)">Edit<i class="fas fa-user-edit"></i></button>' + '</td>';

                            row += '</tr>';
                            $('#tblLossData tbody').append(row);

                        });
                        addSerialNumber("tblLossData");
                    }
                }
            })
        }

        function ShowAddLoss() {

            document.getElementById("txtlosscode").value = '';
            document.getElementById("txtlossdesc").value = '';
            document.getElementById("txtaction").value = '';
            document.getElementById("txtlossdeschindi").value = '';
            document.getElementById("txtactionhindi").value = '';
            
            $('#createModal').modal('show');

        }

        // sending table data to popup window

        function showpopup(rowIndexOfGridview) {
            selectedrow = rowIndexOfGridview.parentNode.parentNode;


            var losscode = selectedrow.cells[1].innerHTML;
            txtupdatelosscode.value = losscode;

            var lossdesc = selectedrow.cells[2].innerHTML;
            txtupdatelossdesc.value = lossdesc;

            var action = selectedrow.cells[3].innerHTML;
            txtupdateaction.value = action;

            var lossdeschindi = selectedrow.cells[4].innerHTML;
            txtupdatelossdeschindi.value = lossdeschindi;

            var actionhindi = selectedrow.cells[5].innerHTML;
            txtupdateactionhindi.value = actionhindi;

            $("#UpdateModal").modal('show');

        }

        function sendDataToInsert() {

            // Required Field validation
            var losscode = document.getElementById("txtlosscode").value;
            var lossdesc = document.getElementById("txtlossdesc").value;
            var action = document.getElementById("txtaction").value;
            var lossdeschindi = document.getElementById("txtlossdeschindi").value;
            var actionhindi = document.getElementById("txtactionhindi").value;
            
            if (losscode == "" || lossdesc == "" || action==""||
                losscode == null || lossdesc == null || action==null) {
                alert("Some Field is missing.. Please Enter Data.");
            }
            else {

                $.post("/addloss",
                    { losscode: losscode, lossdesc: lossdesc,action:action, lossdeschindi: lossdeschindi,actionhindi:actionhindi },
                    function (data) {

                        if (data != null) {
                            var response = data.rowsAffected;
                            if (response.length > 0) {

                                $("#createModal").modal('hide');
                                alert("Data saved successfully...");

                                var row = '<tr>';
                                row += '<td></td>';
                                row += '<td>' + losscode + '</td>';
                                row += '<td>' + lossdesc + '</td>';
                                row += '<td>' + action + '</td>';
                                row += '<td>' + lossdeschindi + '</td>';
                                row += '<td>' + actionhindi + '</td>';
                                row += '<td>' + '<button class="btn btn-primary" onclick="return showpopup(this)">Edit<i class="fas fa-user-edit"></i></button>' + '</td>';
                                row += '</tr>';
                                $('#tblLossData tbody').append(row);
                                addSerialNumber("tblLossData");
                            }
                        }
                    });

            }

        }

        function sendDataToUpdate() {
            // Required Field validation
            var losscode = document.getElementById("txtupdatelosscode").value;
            var lossdesc = document.getElementById("txtupdatelossdesc").value;
            var action = document.getElementById("txtupdateaction").value;
            var lossdeschindi = document.getElementById("txtupdatelossdeschindi").value;
            var actionhindi = document.getElementById("txtupdateactionhindi").value;

           if (losscode == "" || lossdesc == "" || action==""||
                losscode == null || lossdesc == null || action==null) {
                alert("Some Field is missing.. Please Enter Data.");
            }
            else {
                //Updation code for site updates

                $.post("/updateloss",
                    { losscode: losscode, lossdesc: lossdesc,action:action, lossdeschindi: lossdeschindi,actionhindi:actionhindi },
                    function (data) {

                        if (data != null) {
                            var response = data.rowsAffected;
                            if (response.length > 0) {

                                $("#UpdateModal").modal('hide');
                                alert("Data Updated successfully...");

                                selectedrow.cells[1].innerHTML = losscode;
                                selectedrow.cells[2].innerHTML = lossdesc;
                                selectedrow.cells[3].innerHTML = action;
                                selectedrow.cells[4].innerHTML = lossdeschindi;
                                selectedrow.cells[5].innerHTML = actionhindi;
                            }
                        }
                    });

            }

        }

        function sendDataToDelete() {
            // Required Field validation

            var choice = confirm("Are you sure to delete this record?");
            if (choice == true) {
                var losscode = document.getElementById("txtupdatelosscode").value;

                if (losscode == "" || losscode == null) {
                    alert("Some Field is missing.. Please Enter Data.");
                }
                else {
                    //Deletion code for records

                    $.post("/deleteloss", { losscode: losscode }, function (data) {

                        if (data != null) {
                            var response = data.rowsAffected;
                            if (response.length > 0) {
                                $("#UpdateModal").modal('hide');
                                alert("Data Deleted successfully...");

                                var i = selectedrow.rowIndex;
                                document.getElementById("tblLossData").deleteRow(i);
                                addSerialNumber("tblLossData");
                            }
                        }
                    });
                }

            }
        }

    </script>

    <script>
        $("#new-header").load("header.html");
        $("#new-footer").load("footer.html");
    </script>
</body>

</html>